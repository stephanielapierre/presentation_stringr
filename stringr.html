<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STRINGR</title>
    <meta charset="utf-8" />
    <meta name="author" content="par Stéphanie Lapierre" />
    <script src="stringr_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer-2.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# STRINGR
## Un package de TIDYVERSE
### par Stéphanie Lapierre
### 23 novembre 2021

---






class: center, middle


&lt;center&gt;&lt;img src="https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png" height="350px" /&gt;&lt;/center&gt;


### « Strings are not glamorous, high-profile components of R, but they do play a big role in many data cleaning and preparation tasks. » 
[stringr, tidyverse](https://stringr.tidyverse.org/)

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

## Chaîne de caractère

Selon GeeksforGeeks 

&gt; Les chaînes de caractères (_string_) sont essentiellement un ensemble de caractères. Un ou plusieurs caractères inclus dans une paire de guillemets simples ou doubles correspondants peuvent être considérés comme une chaîne de caractères dans R. Les chaînes représentent un contenu textuel et peuvent contenir des nombres, des espaces et des caractères spéciaux.  [(Tranduction libre)](https://www.geeksforgeeks.org/r-strings/)

&lt;br /&gt; 


```r
string &lt;- "Voici une chaîne de caractère"
```

&lt;br /&gt; 


```r
string2 &lt;- 'Pour inclure une "citation", on utilise les guillemets simples.'
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

## stringr

#### Un *package* de Tidyverse
Le *package stringr* fournit un ensemble de fonctions pour faciliter le travail avec les chaînes de caractères. Bâti à partir de *stringi*, *stringr* offre les fonctions les plus importantes et les plus utilisées pour manipuler les chaînes de caractères.

&lt;br /&gt; 

#### Astuce
Si aucune fonction de *stringr* ne répond à vos besoins, les chances sont que vous trouviez ce que vous cherchez dans *stringi*.


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

## Des fonctions qui commencent par `str_`

.pull-left[

*   `str_c`
*   `str_conv`
*   `str_count`         
*   `str_detect`      
*   `str_dup`      
*   `str_ends`
*   `str_extract` et `str_extract_all` 
*   `str_flatten`     
*   `str_glue`        
*   `str_glue_data`   
*   `str_interp`      
*   `str_length`     
*   `str_locate` et `str_locate_all`  
*   `str_match` et `str_match_all`   
*   `str_order`       
*   `str_pad`         
*   `str_remove` et `str_remove_all`  
*   `str_replace` et `str_replace_all`
]

.pull-right[

*   `str_replace_na`  
*   `str_sort`        
*   `str_split`       
*   `str_split_fixed`
*   `str_squish`      
*   `str_starts`      
*   `str_sub`         
*   `str_sub&lt;-`       
*   `str_subset`      
*   `str_to_lower` et `str_to_upper`  
*   `str_to_sentence`
*   `str_to_title`    
*   `str_trim`        
*   `str_trunc`       
*   `str_view` et `str_view_all`    
*   `str_which`      
*   `str_wrap`     
]


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Base R contre stringr

&lt;br /&gt; 

Bien que R offre un ensemble de fonctions pour travailler avec les chaînes de caractères, on reproche 
aux fonctions de base R de manquer de cohérence et d'être plus difficile à apprendre. 

&lt;br /&gt; 

Pourquoi utiliser *stringr*

* La structure des fonctions et des arguments est cohérente et consistante. Le premier argument d'une fonction est toujours le vecteur sur lequel on travaille. C'est d'ailleurs ce qui fait que *stringr* est particulièrement adapté pour l'utilisation des pipes (%&gt;%).
* Simplifie les opérations.
* Les résultats des fonctions de *stringr* peuvent facilement être réutilisés. Le package permet notamment de s'assurer que les données manquantes demeurent des données manquantes.

---
class: inverse center middle

# Exploration et nettoyage des données


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Exploration des chaînes de caractères

La fonction `str_length` pour évaluer la longueur d'une chaine de caractères

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", NA)

str_length(x)
```

```
## [1]  7  5  5  4  7  7  6  7 NA
```

```r
# Base R
nchar(x)
```

```
## [1]  7  5  5  4  7  7  6  7 NA
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les majuscules et les minuscules

*stringr* dispose de quatre fonctions pour nous aider à convertir les majuscules et les minuscules.

&lt;br /&gt; 

La fonction `str_to_upper` pour mettre tous les caractères en majuscule


```r
x &lt;- c("lEs dOnNéEs pArLeNt d'ElLeS-MêMeS")

str_to_upper (x)
```

```
## [1] "LES DONNÉES PARLENT D'ELLES-MÊMES"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les majuscules et les minuscules

*stringr* dispose de quatre fonctions pour nous aider à convertir les majuscules et les minuscules.

&lt;br /&gt; 

La fonction `str_to_lower` pour mettre tous les caractères en minuscule


```r
x &lt;- c("lEs dOnNéEs pArLeNt d'ElLeS-MêMeS")

str_to_lower (x)
```

```
## [1] "les données parlent d'elles-mêmes"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les majuscules et les minuscules

*stringr* dispose de quatre fonctions pour nous aider à convertir les majuscules et les minuscules.

&lt;br /&gt; 

La fonction `str_to_sentence` pour mettre une majuscule au début de la phrase


```r
x &lt;- c("lEs dOnNéEs pArLeNt d'ElLeS-MêMeS")

str_to_sentence (x)
```

```
## [1] "Les données parlent d'elles-mêmes"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les majuscules et les minuscules

*stringr* dispose de quatre fonctions pour nous aider à convertir les majuscules et les minuscules.

&lt;br /&gt; 

La fonction `str_to_title` pour mettre des majuscules dans un titre


```r
x &lt;- c("lEs dOnNéEs pArLeNt d'ElLeS-MêMeS")

str_to_title(x)
```

```
## [1] "Les Données Parlent D'elles-Mêmes"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les majuscules et les minuscules

####Astuce
Chaque langue comporte ces propres particularités. Afin de permettre à R d'exécuter correctement les manipulations demandées, l'argument `locale` permet d'indiquer la langue des caractères. Par défaut, les fonctions de *stringr* utilisent "en" pour anglais.

Par exemple dans l'alphabet hawaïen, le *e* vient avec le *b*.

```r
x &lt;- c("apple", "eggplant", "banana")

str_sort(x, locale = "en")  # En anglais
```

```
## [1] "apple"    "banana"   "eggplant"
```

```r
str_sort(x, locale = "haw") # En hawaïen
```

```
## [1] "apple"    "eggplant" "banana"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour extraire ou remplacer des caractères

&lt;br /&gt; 

La fonction `str_sub` pour extraire une partie des caractères. Cette fonction est composée de trois arguments, soit le vecteur, la position de départ et la position de fin.


```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", NA)

# Le 3e caractère
str_sub(x, 3, 3)
```

```
## [1] "r" "n" "r" "r" "p" "t" "a" "p" NA
```

```r
# Du 2e caractère à l'avant-dernier caractère
str_sub(x, 2, -2)
```

```
## [1] "ercur" "énu"   "err"   "ar"    "upite" "aturn" "ranu"  "eptun" NA
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour extraire ou remplacer des caractères

La fonction `str_sub` peut aussi être utilisée pour modifier un caractère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", NA)

# Remplacer le troisième caractère par un point d'interrogation
str_sub(x, 3, 3) &lt;- "?"
x
```

```
## [1] "me?cure" "vé?us"   "te?re"   "ma?s"    "ju?iter" "sa?urne" "ur?nus" 
## [8] "ne?tune" NA
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour combiner des caractères

La fonction `str_c` permet de combiner des caractères


```r
str_c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune")
```

```
## [1] "mercurevénusterremarsjupitersaturneuranusneptune"
```

&lt;br /&gt; 

En ajoutant l'argument `sep`, on indique par quoi séparer les caractères

```r
str_c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", sep = " et ")
```

```
## [1] "mercure et vénus et terre et mars et jupiter et saturne et uranus et neptune"
```

---
class: inverse center middle

# Les espaces


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les espaces

*stringr* dispose de trois fonctions ajouter, enlever ou modifier les espaces.

La fonction `str_pad` permet d'obtenir une chaîne de caractères d'une longueur déterminer en ajoutant des espaces supplémentaires à gauche, à droite ou des deux côtés


```r
x &lt;- c("données")

str_pad(x, 20, "left")      # Par défaut, les espaces sont ajoutés à gauche
```

```
## [1] "             données"
```

```r
str_pad(x, 20, "right")
```

```
## [1] "données             "
```

```r
str_pad(x, 20, "both")
```

```
## [1] "      données       "
```


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les espaces

*stringr* dispose de trois fonctions ajouter, enlever ou modifier les espaces.

La fonction `str_trim` permet d'éliminer d'une chaîne de caractères toutes les espaces superflues à gauche, à droite ou des deux côtés


```r
x &lt;- c("      a", "b      ", "   c   ")

str_trim(x, "left")      
```

```
## [1] "a"       "b      " "c   "
```

```r
str_trim(x, "right")
```

```
## [1] "      a" "b"       "   c"
```

```r
str_trim(x, "both")      # Par défaut, les espaces sont enlevés des deux côtés
```

```
## [1] "a" "b" "c"
```


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Pour gérer les espaces

*stringr* dispose de trois fonctions ajouter, enlever ou modifier les espaces.

La fonction `str_wrap` permet d'enlever d'ajuster le format d'une chaîne de caractères pour obtenir un paragraphe


```r
x &lt;- c("Illud tamen te esse admonitum volo, primum ut qualis es talem te esse omnes existiment ut, quantum a rerum turpitudine abes, tantum te a verborum libertate seiungas; deinde ut ea in alterum ne dicas, quae cum tibi falso responsa sint, erubescas.")

cat(str_wrap(x, width = 80))
```

```
## Illud tamen te esse admonitum volo, primum ut qualis es talem te esse omnes
## existiment ut, quantum a rerum turpitudine abes, tantum te a verborum libertate
## seiungas; deinde ut ea in alterum ne dicas, quae cum tibi falso responsa sint,
## erubescas.
```

```r
cat(str_wrap(x, width = 50, indent = 4))
```

```
##     Illud tamen te esse admonitum volo, primum
## ut qualis es talem te esse omnes existiment ut,
## quantum a rerum turpitudine abes, tantum te a
## verborum libertate seiungas; deinde ut ea in
## alterum ne dicas, quae cum tibi falso responsa
## sint, erubescas.
```



---
class: inverse center middle

# À la recherche de *pattern*


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Les expressions régulières

Les **expressions régulières** (ou *regexps*) permettent de décrire un *pattern* qui apparait dans une chaîne de caractère.

La *cheat sheet* du *package stringr* présente un bon résumé des différents concepts liés aux expressions régulières.

![](regex.png)

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_detect` permet de savoir si des chaînes de caractères répondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_detect(x, "[aeiou]")
```

```
## [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_subset` permet d'extraire les chaînes de caractères répondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_subset(x, "[aeiou]")
```

```
## [1] "mercure" "vénus"   "terre"   "mars"    "jupiter" "saturne" "uranus" 
## [8] "neptune"
```


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_count` permet de compter combien de caractères répondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_count(x, "[aeiou]")
```

```
## [1] 3 1 2 1 3 3 3 3 0
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_subset` permet d'extraire les chaînes de caractères répondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_subset(x, "[aeiou]")
```

```
## [1] "mercure" "vénus"   "terre"   "mars"    "jupiter" "saturne" "uranus" 
## [8] "neptune"
```


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_locate` permet d'obtenir la position du premier caractère qui répond au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_locate(x, "[aeiou]")
```

```
##       start end
##  [1,]     2   2
##  [2,]     4   4
##  [3,]     2   2
##  [4,]     2   2
##  [5,]     2   2
##  [6,]     2   2
##  [7,]     1   1
##  [8,]     2   2
##  [9,]    NA  NA
```



---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_extract` permet d'extraire le premier caractère qui répond au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_extract(x, "[aeiou]")
```

```
## [1] "e" "u" "e" "a" "u" "a" "u" "e" NA
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_match` permet d'extraire des parties de caractères qui correspondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

# Extraire les caractères de chaque côté des voyelles
str_match(x, "(.)[aeiou](.)")
```

```
##       [,1]  [,2] [,3]
##  [1,] "mer" "m"  "r" 
##  [2,] "nus" "n"  "s" 
##  [3,] "ter" "t"  "r" 
##  [4,] "mar" "m"  "r" 
##  [5,] "jup" "j"  "p" 
##  [6,] "sat" "s"  "t" 
##  [7,] "ran" "r"  "n" 
##  [8,] "nep" "n"  "p" 
##  [9,] NA    NA   NA
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_replace` permet de remplacer les caractères qui répondent au critère

```r
x &lt;- c("mercure", "vénus", "terre", "mars", "jupiter", "saturne", "uranus", "neptune", "why")

str_replace(x, "[aeiou]", "?")
```

```
## [1] "m?rcure" "vén?s"   "t?rre"   "m?rs"    "j?piter" "s?turne" "?ranus" 
## [8] "n?ptune" "why"
```

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Détecter des *patterns*

&lt;br /&gt; 

Les fonctions qui intégrent les expressions régulières ont toutes la même structure `str_...(x, pattern)`

&lt;br /&gt; 

La fonction `str_split` permet de séparer les chaînes de caractère

```r
x &lt;- c("mercure, vénus, terre, mars, jupiter, saturne, uranus, neptune")

str_split(x, ", ")
```

```
## [[1]]
## [1] "mercure" "vénus"   "terre"   "mars"    "jupiter" "saturne" "uranus" 
## [8] "neptune"
```



---
class: inverse center middle

# *stringr* en application


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Analyse textuelle des données du Titanic

.pull-left[

&lt;br /&gt; 
&lt;img src="images/titanic_by-noaa_unsplash.jpg" alt="" width="65%"/&gt;
]

.pull-right[

&lt;br /&gt; 
&lt;br /&gt; 
&lt;br /&gt; 

**Using Stringr and Regex to Extract Features from Textual and Alphanumeric Data in R**

Analyse de Matti Fuchs publié le 1&lt;sup&gt;er&lt;/sup&gt; février 2020 sur Towards Data Science

L'analyse complète est disponible [ici](https://towardsdatascience.com/using-stringr-and-regex-to-extract-features-from-textual-alphanumeric-and-punctuation-data-in-r-2565256c0a77)
]


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Base de données du Titanic


```r
library(titanic)
df &lt;- titanic_train
knitr::kable(head(df, 3), format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; PassengerId &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Survived &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Pclass &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Sex &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Age &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SibSp &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Parch &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Ticket &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Fare &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Cabin &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Embarked &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Braund, Mr. Owen Harris &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; male &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A/5 21171 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.2500 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; S &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Cumings, Mrs. John Bradley (Florence Briggs Thayer) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; female &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 38 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PC 17599 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.2833 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C85 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Heikkinen, Miss. Laina &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; female &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 26 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; STON/O2. 3101282 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.9250 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; S &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Prédicteur de la survie

Questions à explorer
- Est-ce que la noblesse a eu plus de chances de survivre que le commun des mortels?
- Est-ce que les jeunes femmes célibataires ont eu plus de change de survivre?


```r
head(df$Name, 10)
```

```
##  [1] "Braund, Mr. Owen Harris"                            
##  [2] "Cumings, Mrs. John Bradley (Florence Briggs Thayer)"
##  [3] "Heikkinen, Miss. Laina"                             
##  [4] "Futrelle, Mrs. Jacques Heath (Lily May Peel)"       
##  [5] "Allen, Mr. William Henry"                           
##  [6] "Moran, Mr. James"                                   
##  [7] "McCarthy, Mr. Timothy J"                            
##  [8] "Palsson, Master. Gosta Leonard"                     
##  [9] "Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)"  
## [10] "Nasser, Mrs. Nicholas (Adele Achem)"
```

Pour répondre à ces questions, on peut extraire le titre de civilité de la variable *Name*


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Extraction du titre de civilité 

Pour éviter les problèmes ou les mauvaises surprises, on met en minuscule tous les noms


```r
df$lcName = str_to_lower(df$Name)
```


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Extraction du titre de civilité 

&lt;br /&gt; 

Il faut maintenant utiliser une expression régulière afin de pouvoir extraire le titre de civilité. 
On a vu que les titres de civilité sont précédés d'un espace et se termine par un point.

&lt;br /&gt; 

L'expression régulière est composée de trois parties

1. `(?&lt;=\\s)` indique que la chaîne de caractères qu'on recherche est précédée (?&lt;=) d'un espace (\\s).
1. `[[:alpha:]]+` indique que la chaîne de caractères qu'on recherche est composés d'un ou plusieurs (+) lettres ([[:alpha:]]).
1. `(?=\\.)` indique que la chaîne de caractères qu'on recherche précède (?=) un point (\\.).

&lt;br /&gt; 

** (?&lt;=\\s)[[:alpha:]]+(?=\\.) **


---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Extraction du titre de civilité 

.pull-left[

```r
df$title = str_extract( df$lcName, "(?&lt;=\\s)[[:alpha:]]+(?=\\.)" )

df$title &lt;- as.factor(df$title)

df_title &lt;- data.frame(summary(df$title))
```
]

.pull-right[

```r
df_title
```

```
##          summary.df.title.
## capt                     1
## col                      2
## countess                 1
## don                      1
## dr                       7
## jonkheer                 1
## lady                     1
## major                    2
## master                  40
## miss                   182
## mlle                     2
## mme                      1
## mr                     517
## mrs                    125
## ms                       1
## rev                      6
## sir                      1
```
]

---
background-image: url(https://d33wubrfki0l68.cloudfront.net/45fd04ad9cdb2159fea08d07dbc11e742d68e4e3/df327/css/images/hex/stringr.png)
background-position: 1040px 40px
background-size: 80px

### Répartition des titres de civilité des passagers du Titanic


```r
ggplot(data.frame(table(df$title)),aes(x=reorder(Var1, -Freq),y=Freq))+
  geom_col(fill='darkgreen')+
  labs(x="Titre de civilité",y="Nombre")
```

&lt;img src="stringr_files/figure-html/unnamed-chunk-30-1.png" width="100%" /&gt;


---
class: center, middle

# Merci!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
